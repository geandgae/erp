<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
/**
 * ============================================================================
 * 사용자 UI
 *
 * @author <a href="mailto:@">jissfa</a>
 * @version 1.0
 * @since 1.0
 * <p>
 * History<br>
 * 1.0  2010.11.22  jissfa    initial version
 * ============================================================================
 */
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>공지사항등록</title>
<!-- CSS -->
<link rel="stylesheet" type="text/css" href="./jquery/ui/themes/jquery-ui.css"/>
<link rel="stylesheet" type="text/css" href="./jquery/plugin/jqGrid/css/ui.jqgrid.css"/>
<link rel="stylesheet" type="text/css" href="./jquery/plugin/jqGrid/plugins/ui.multiselect.css"/>
<link rel="stylesheet" type="text/css" href="./nsf/css/nsf.css"/>
<link rel="stylesheet" type="text/css" href="./nsf/css/new_nsf.css"/>

<!-- JS -->
<script type="text/javascript" src="./jquery/jquery.js"></script>
<script type="text/javascript" src="./jquery/ui/jquery-ui.js"></script>
<script type="text/javascript" src="./jquery/plugin/blockUI/jquery.blockUI.js"></script>
<script type="text/javascript" src="./jquery/ui/jquery.ui.datepicker-ko.js"></script>
<!--<script type="text/javascript" src="./nsf/nsf.js"></script>-->

<!-- JQ Grid -->
<script type="text/javascript" src="./jquery/plugin/jqGrid/plugins/ui.multiselect.js"></script>
<script type="text/javascript" src="./jquery/plugin/jqGrid/i18n/grid.locale-en.js"></script>
<script type="text/javascript" src="./jquery/plugin/jqGrid/jquery.jqGrid.js"></script>
<script type="text/javascript" src="./jquery/plugin/form/jquery.form.js"></script>

<!-- SB Grid -->
<script type="text/javascript" src="./jquery/plugin/SBGrid3/sbgrid3.js" ></script>
<link rel="stylesheet" href="./jquery/plugin/SBGrid3/css/sbgrid3.css"  />

<!-- swalert -->
<script type="text/javascript" src="./jquery/plugin/sweetalert2/sweetalert2.js" ></script>
<link rel="stylesheet" href="./jquery/plugin/sweetalert2/css/sweetalert2.css"  />

<!-- JS2 nsf.js/nsfPopup.js-->
<script type="text/javascript" src="./nsf/nsf.message.js"></script>
<script type="text/javascript" src="./nsf/nsf.request.js"></script>
<script type="text/javascript" src="./nsf/nsf.popup.js"></script>
<script type="text/javascript" src="./nsf/nsf.util.js"></script>
<script type="text/javascript" src="./nsf/nsf.util.jqgrid.js"></script>
<script type="text/javascript" src="./nsf/nsf.util.sbgrid.js"></script>

<script type="text/javascript" src="./nsf/json2.js"></script>
<script type="text/javascript" src="./nsf/jquery.blockUI.js"></script> 
<style type="text/css">
</style>
<script type="text/javascript" src="./nsf/nsf.js"></script>
<script type="text/javascript">
//-----------------------------------------------------------------
// Initialize Section
//-----------------------------------------------------------------
// var stateEditM1 = "N";

var sbGridM1;

const appUri = "./webApp/wisen/op/ntc/control/OpNtc010SC";

function fInitBefore() {
	NsfUtil.select.append("select[id=cboYnUse]", "N", "N");
	NsfUtil.select.append("select[id=cboYnUse]", "Y", "Y");
}

/**
 * generated By NsfJ Source Generator
 * 페이지 초기화
 * @since 1.0
 */
function fInitPage() {
	jQuery("#sectionA1 #toggle").on("click", function() {
		jQuery("#sectionA2").slideToggle(null, function() {Nsf.resize();});
	});

	jQuery("#sectionA2 #grid .nsf-mini-vertical").on("click", function() {
		jQuery("#sectionA2 #grid .nsf-form-search").slideToggle(null, function() {Nsf.resize();});
	});

	fCreateSBGridM1();

	jQuery("#btnFindM1").click(function() {
		fSearch();
		// 		fLoadDataM1();
	});

	jQuery("#btnProcessM1").click(function() {
		fProcessM1();
	});

	jQuery("#btnProcessP1").click(function() {
		if(jQuery("#sectionB1 #editFlag").val() == ""){
			NsfMessage.alert("저장할 데이터를 입력해주세요");
			return;
		}else{
			fProcessP1();
		}
	});

	jQuery("#eClose").click(function() {
		jQuery("#sectionB1").dialog("close");
	});

	jQuery("#btnRemoveM1").click(function() {
		fRemoveM1();
	});

	jQuery("#btnRegistM1").live("click", function() {
		fClearForm();

		jQuery("#sectionB1").dialog("open");
		// 		var height;
		// 		height = height - Nsf.offsetHeight;
	});

	jQuery("#sectionB1").dialog({
		title: "공지사항등록",
		autoOpen: false,
		modal: true,
		height: 500,
		width: 700,
		bgiframe: true,		//ie6에서 dialog위로 combo box 올라오는거 방지
	resizable: false,
		overlay: {
	opacity: 0.5,
			background: "black"
},
	beforeClose: function() {

	}
});

	// 		width = width - 0;

	//     }).trigger("resize");

	NsfUtil.field.reset(".nsf-form-search");

	jQuery("#sectionB1").dialog("close");
}

function fCreateSBGridM1(){

	// 1.Grid Set Column
	let columnsM1 = [
		{field:"noNotice", caption:"공지번호", width:100, sortable:true, colCss:"nsf-status-ess", align:"center", visible:false, editable:false, directApplyValue:true }
		,{field:"ynUse", caption:"사용여부", width:70, sortable:true, colCss:"nsf-status-ess", align:"center", visible:true, editable:false, directApplyValue:true, type:"combo"
		, items: [
			{ value: "N", label: "N" },
			{ value: "Y", label: "Y" },
			] }
		,{field:"title", caption:"제목", width:300, sortable:true, colCss:"nsf-status-ess", align:"left", visible:true, editable:false, maxLength:100, directApplyValue:true }
		,{field:"contents", caption:"내용", width:800, sortable:false, colCss:"nsf-status-ess", align:"left", visible:true, editable:false, directApplyValue:true }
		,{field:"contents2", caption:"contents2", width:400, sortable:false, colCss:"nsf-status-ess", align:"left", visible:false, editable:false, directApplyValue:true, type:"multiText", showPreLine:"true" }
	];

	// 2.DataSource Config
	let dsConfigM1 = {
		ajax : {
			select  : async function(request) {
				return await fLoadDataM1(request);
			},
			selected: "content",
		},
	};

	// 3.Grid Config
	let gridConfigM1 = {
		dataSource: [],
		container: "#sbGridM1",
		columns: columnsM1,
		height: 200,
		editable: true,
		showCheck: false,
		showRowNo: true,
		doCommand: function(grid, name, command){
			switch (name) {
                case "event": {
					if (command.event.type == "click") {
						fSBGridM1OnClick(grid, name, command);    // 클릭 이벤트
					} else if (command.event.type == "dblclick") {
						fSBGridM1OnDblClick(grid, name, command); // 더블클릭 이벤트
					}
					break;
				}
                case "focus" :{
					break;
				}
                case "add": {
					NsfUtilSBGrid.addRowColumnEditable(sbGridM1, sbGridM1.columns[3]); // Row 추가후 바로 입력가능상태 설정.
					break;
				}
                case "updated": {
					fSBGridM1OnUpdate(grid, name, command);
					break;
				}
            }
		}
	}

	// 4.Create Grid
	sbGridM1 = NsfUtilSBGrid.create(dsConfigM1, gridConfigM1);
	sbGridM1.refresh();
}

function fSBGridM1OnUpdate (grid, name, command) {
	var cellname = command.values[0].field;

	var rowdata = jQuery(this).getRowData(rowid);
	if(rowdata.editFlag != 'C' && rowdata.editFlag != 'U' )
        SBGrid3.setValue(sbGridM1,rowid,{editFlag:"U"});
}

function fSBGridM1OnClick(grid, name, command) {
	// Grid Cell Click
}

function fResizePageWidth() {
	NsfUtilSBGrid.setWidth(sbGridM1,jQuery("#sectionA2").width()-Nsf.offsetWidth);
}

function fResizePageHeight() {
	var height;
	height = jQuery("#sectionA2").height();
	height = height - (jQuery("#sectionA2 #grid .nsf-form-search").is(":visible") ? jQuery("#sectionA2 #grid .nsf-form-search").outerHeight() : 0);
	height = height - jQuery("#sectionA2 #grid .nsf-btnbar").outerHeight();
	height = height - jQuery("#sectionA2 #grid .nsf-mini-vertical").outerHeight();
	height = height - jQuery("#sbGridnavM1").outerHeight();
	height = height - Nsf.offsetHeight;
	NsfUtilSBGrid.setHeight(sbGridM1,height);

}

function fSearch() {
	SBGrid3.reload(sbGridM1, true);
}

function fLoadDataM1(request = {}, dataType = "json") { 
	return new Promise(function (resolve, reject) { 
		resolve( { selected : [
			{
				"title": "테스트",
				"contents": "테스트 공지사항",
				"contents2": "테스트 공지사항",
				"noNotice": "N2022080501",
				"ynUse": "Y"
			}
		] } ); 
	});
}

function fRemoveM1() {
	if (SBGrid3.getFocusedKey(sbGridM1) === undefined){
		NsfMessage.alert("삭제할 행을 선택해 주세요!");
		return;
	}

	var selrow = SBGrid3.getFocusedKey(sbGridM1);
	if( selrow != null ){
		var rowdata = SBGrid3.getValue(sbGridM1,selrow,"");
		if(rowdata.editFlag != "C"){
			NsfUtilSBGrid.deleteRow(sbGridM1);
		}else{
			NsfUtilSBGrid.deleteRow(sbGridM1);
		}

	}
    else{
		NsfMessage.alert("삭제할 행을 선택해 주세요!", "I");
	}
}

function fClearForm(){
	jQuery("#txtEditFlag").val("C");
	jQuery("#txtTitle").val("");
	jQuery("#txtContents").val("");
	jQuery("#cboYnUse").val("Y");
}

function fProcessM1() {
	var essColumns = ["noNotice","ynUse","title","contents","contents2"];  // 입력 필수 항목

	var arrM1 = NsfUtilSBGrid.getSaveData(sbGridM1, essColumns);
	if(arrM1?.data === undefined && arrM1.name != undefined) {
		var vConf = NsfMessage.alert("[필수값] : "+arrM1.name + " (은)는 필수항목입니다.",{type:"W"});
		vConf.then(function(val) {
			if(val){
				// var cellFouce = SBGrid3.moveFocus(sbGridM1,arrM1.rowIndex,arrM1.column);
				// cellFouce.then(function(val) {
				SBGrid3.columnEditable(sbGridM1, arrM1.rowKey, arrM1.column, true);
			}
		});
		return;
	} else {
		if(arrM1.length === 0){ NsfMessage.alert("저장할 데이터가 없습니다."); return; }

		NsfRequest.ajax.doPost(	appUri,
								   [{name: "methodName", value: "processM1"},
									{name: "params", value: JSON.stringify(arrM1.data)}],
								   function(data) {
									   /** Grid교체 - Save Data Grid Reload 202311 */
									   SBGrid3.reload(sbGridM1, false); // 현재 page 유지 Reload
									   SBGrid3.setClientData(sbGridM1, []);
									   NsfMessage.alert(data.message);
								   }
		);
	}
}

function fProcessP1(){
	var param = NsfUtil.field.serializeJSON(jQuery("#sectionB1"));

	NsfRequest.ajax.doPost(appUri, [{name: "methodName", value: "processP1"},
									{name: "params", value: param},
									{name: "title", value: jQuery("#txtTitle").val()}],
						   function(data) {
							   jQuery("#sectionB1 #txtEditFlag").val("");
							   // 									NsfMessage.alert(data.message);
							   fSearch();
							   fClearForm();

							   jQuery("#sectionB1").dialog("close");
						   },
						   function(error){
							   jQuery("#sectionB1 #txtEditFlag").val("");
						   });
}

function fSBGridM1OnDblClick(grid, name, command) {
	var cellname = command.column?.field;

	// 		NsfMessage.alert("sel");
	// 		return;
	// 	}

	// 	var id = rowdata.idProgram;
	// 	var name = rowdata.nmProgram;

	// 	var uri = "./webView" + rowdata.uriProgram.toString();

	// 	parent.fOpenMenu(id, name, uri);

	if (null == jQuery("#sbGridM1").getGridParam("selrow")) return;
	var rowdata = SBGrid3.getValue(sbGridM1,jQuery("#jqGridM1").getGridParam("selrow"),"");

	jQuery("#txtTitle").val(rowdata.title);
	jQuery("#cboYnUse").val(rowdata.ynUse);
	jQuery("#txtContents").val(rowdata.contents2);
	jQuery("#txtNoNotice").val(rowdata.noNotice);
	jQuery("#txtEditFlag").val("U");

	jQuery("#sectionB1").dialog("open");
}

</script>

</head>
<body>
<!-- 2023-02-20 팝업 수정-->
<div id="sectionA1" class="nsf-section nsf-widget-header ui-widget-header">
	<table><tr><td>
		<label>공지사항등록</label>
	</td><td class="nsf-right">
		<button id="toggle" type="button"></button>
	</td></tr></table>
</div>

<div id="sectionA2" class="nsf-section-resize nsf-widget-content" additionHeight="100">
	<div class="nsf-panel">
		<div id="grid">
			<div class="body">
				<div class="nsf-btnbar">
					<table><tr><td class="nsf-right">
						<button id="btnFindM1" type="button" class="nsf-btn-search">조회</button>
						<button id="btnRegistM1" type="button" class="nsf-btn-add">추가</button>
						<button id="btnRemoveM1" type="button" class="nsf-btn-delete">삭제</button>
						<button id="btnProcessM1" type="button" class="nsf-btn-save">저장</button>
					</td></tr></table>
				</div>
				<div id="sbGridM1"></div>
			</div>
		</div>
	</div>
</div>

<div id="sectionB1" class="nsf-widget-content">
	<div class="nsf-panel">
		<div id="grid">
            <div class="head nsf-form-search">
				<ul>
					<li><span>사번</span>
						<input type="text" id="eCdSearch" name="cdSearch" class="nsf-param">
						<select id="eCboWhereFlagFr" name="cbowhereFlagFr" title="조건" class="nsf-param">
						<option value="A">=</option><option value="B">&gt;=</option><option value="C">&lt;=</option><option value="D">&lt;&gt;</option><option value="E">시작문자 포함</option><option value="F">포함</option><option value="G">끝문자 포함</option></select>
					</li>
					<li class="nsf-form-li-2x"><span>성명</span>
						<input type="text" id="eNmSearch" name="nmSearch" class="nsf-param">
						<select id="eCboWhereFlagTo" name="cbowhereFlagTo" title="조건" class="nsf-param">
						<option value="A">=</option><option value="B">&gt;=</option><option value="C">&lt;=</option><option value="D">&lt;&gt;</option><option value="E">시작문자 포함</option><option value="F">포함</option><option value="G">끝문자 포함</option></select>
					</li>
                    <li><span>기준일&nbsp;</span>
						<input type="text" id="txtdtRetireH" name="dtRetire" title="dtRetire" class="nsf-param nsf-center hasDatepicker">
						</li>
					<li class="nsf-form-li-2x"><span>&nbsp;</span>
						<input type="radio" id="rdoFlag1" name="rdoFlag" value="1" class="nsf-param"><label>전체&nbsp;&nbsp;&nbsp;&nbsp;</label>
						<input type="radio" id="rdoFlag2" name="rdoFlag" value="2" class="nsf-param" checked="checked"><label>재직자&nbsp;</label>
						<input type="radio" id="rdoFlag3" name="rdoFlag" value="3" class="nsf-param"><label>퇴직자</label>
					</li>
					<input type="hidden" id="cdDept" name="cdDept" class="nsf-param" value="">
				</ul>
			</div>
			<div class="body">
				<div class="nsf-btnbar pop"><!-- 2023-02-20 추가 pop-->
					<table><tr><td class="nsf-right">
						<button id="btnProcessP1" type="button" class="nsf-btn-save">저장</button>
						<button id="eClose" type="button" class="nsf-btn-close">닫기</button>
					</td></tr></table>
				</div>
			</div>
			<!-- 2023-02-20 삭제 -->
			<!-- <div class="nsf-form">
				<ul>
					<li class="nsf-form-li-2x"><span>제목</span>
						<input type="text" id="txtTitle" name="title" class="nsf-param nsf-status-ess" style="width:472px" maxlength="100">
					</li>
					<li><span>사용여부</span>
						<select id="cboYnUse" name="ynUse" class="nsf-param nsf-status-ess">
	                    </select>
					</li>
					<li class="nsf-form-li-2x" style="height:300px;"><span>내용</span>
						<textarea id="txtContents" name="contents"  cols= "76" rows="20"  class="nsf-param nsf-status-ess" maxlength="2000"></textarea>
					</li>
					<li style="display:none"><span>editFlag</span>
						<input type="text" id="txtEditFlag" name="editFlag" class="nsf-param">
					</li>
					<li style="display:none"><span>공고번호</span>
						<input type="text" id="txtNoNotice" name="noNotice" class="nsf-param">
					</li>
				</ul>
			</div> -->
			<!--// 2023-02-20 삭제 -->
			<!-- 2023-02-20 변경 -->
			<div class="nsf-form pd10">
				<table cellpadding="0" cellspacing="0" class="new_table" style="border-collapse: collapse; border:0;">
					<colgroup>
						<col  style="width: 80px;" />
						<col  style="" />
					</colgroup>
					<tbody>
						<tr>
							<th class="left"> <!-- 2023-02-20 정렬: 기본 center정렬 / left:왼쪽정렬 / right: 오른쪽 정렬 -->
								<span>제목</span>
							</th>
							<td>
								<input type="text" id="txtTitle" name="title" class="nsf-param" style="width:583px" maxlength="100">
							</td>
						</tr>
						<tr>
							<th class="left"> <!-- 2023-02-20 정렬: 기본 center정렬 / left:왼쪽정렬 / right: 오른쪽 정렬 -->
								<span>사용여부</span>
							</th>
							<td>
								<select id="cboYnUse" name="ynUse" class="nsf-param" style="width: 100px;">
								</select>
							</td>
						</tr>
						<tr style="height: 365px;">
							<th class="left"> <!-- 2023-02-20 정렬: 기본 center정렬 / left:왼쪽정렬 / right: 오른쪽 정렬 -->
								<span>내용</span>
							</th>
							<td>
								<textarea id="txtContents" name="contents"  cols= "76" rows="24"  class="nsf-param" maxlength="2000" style="resize: none; width:580px"></textarea>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<!-- 2023-02-20 변경 -->
		</div>
	</div>
</div>

</body>
</html>

